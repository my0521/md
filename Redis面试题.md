---
title: Redis面试题
date: 2020-05-05 20:00:48
categories: 
- Redis
tags:
- Java
- 面试题
---

记录学习过程中Redis相关的一些面试题
<!-- more -->

## Redis高并发和快速的原因
1. Redis是基于内存的，内存的读写速度非常快；
2. Redis是单线程的，省去了很多上下文切换线程的时间；
3. Redis使用多路复用技术，可以处理并发的连接；
- 非阻塞IO，内部实现采用epoll+实现的简单的事件框架。epoll中的读、写、关闭、连接都转化成了事件，然后利用epoll的多路复用特性，绝不在IO上浪费一点时间。
	
## 为什么Redis是单线程的
1. 官方答案
- 因为 `Redis是基于内存的操作，CPU不是Redis的瓶颈，Redis的瓶颈最有可能是机器内存的大小或者网络带宽`。既然单线程容易实现，而且CPU不会成为瓶颈，那么就顺理成章地采用单线程的方案了。
2. 性能指标
- 关于Redis的性能，官方网站也有，普通笔记本轻松处理`每秒几十万的请求`。
3. 详细原因
- 不需要各种锁的性能消耗
	1. Redis的数据结构并不是简单的Key-Value，还有list，hash等复杂的结构，这些结构有可能进行很细粒度的操作，比如很长的列表后面添加一个元素，在hash中添加或者删除一个对象，`这些操作在多线程下可能就需要非常多的锁，导致结果的同步开销大大增加`。
	2. `在单线程的情况下，就不用去考虑各种锁的问题`，不存在加锁释放锁的操作，没有因为可能出现死锁而导致的性能消耗。	
- 单线程多进程集群方案
	1. `单线程的每核心效率非常高`，多线程自然是可以比单线程有更高的性能上限，但是在今天的计算环境中，即使是单机多线程的上限也往往不能满足需要了，需要进一步摸索的是多服务集群化的方案，这些方案中多线程的技术照样是用不上的，`所以才有单线程、多进程的集群解决方案`   
- CPU消耗
	1. 使用单线程，避免了不必要的上下文切换和竞争条件，也不存在多进程或者多线程切换而消耗CPU
	2. 如果想充分利用多核CPU性能，可以开启多个Redis进程

## Redis单线程的优劣
1. 单进程单线程的优势
- 代码更清晰，处理逻辑更简单
- 不用去考虑各种锁的问题，可以避免多线程同步带来的一些弊端
- 不存在多进程或者多线程上下文切换而消耗CPU
2. 单进程多线程的弊端
- 无法有效发挥多核CPU性能，不过可以通过单机开多个Redis实例来完善

## IO多路复用
1. redis 采用网络IO多路复用技术来保证在多连接的时候，系统的高吞吐量。
- 多路：多个socket连接
- 复用：复用一个线程
- 多路复用3种技术：select，poll，epoll，epoll是最新的也是最好的多路复用技术。
2. 采用多路复用技术可以让单个线程高效的处理多个连接请求（尽量减少网络IO的时间消耗），且Redis在内存中操作数据的速度非常快（内存操作数据不会成为redis的性能瓶颈），以此造就了Redis具有很高的吞吐量

## 总结
1. Redis是纯内存数据库，一般都是简单的存取操作，线程占用的时间很多，时间的花费主要集中在IO上，所以读取速度快
2. Redis使用的是非阻塞IO，IO多路复用，使用了单线程来轮询描述符，将数据库的开、关、读、写都转换成了事件，减少了线程切换时上下文的切换和竞争
3. Redis采用单线程模型，保证了每个操作的原子性，也减少上下文切换和竞争的时间消耗
4. Redis全程使用Hash结构，读取速度快，还有一些特殊的数据结构，对数据存储进行了优化，如压缩表，对短数据进行压缩存储，再如跳表，使用有序的数据结构加快读取的速度
5. Redis采用自实现的事件分离器，效率比较高，内部采用非租塞的执行方式，吞吐能力比较大。
